<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ラン&ジャンプ レベル3 結果</title>
    <style>
        * {
            font-family: 'Noto Sans JP', sans-serif !important;
            text-align: center;
        }
        .rank-underline {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>レベル3 結果</h1>
    <div id="result-message"></div>
    <div id="time-result"></div> <!-- この要素が存在することを確認 -->
    <div id="coin-result"></div> <!-- この要素が存在することを確認 -->
    <button onclick="location.href='performance3.html'">再挑戦</button>
    <button onclick="location.href='../explain.html'">別のレベルに挑戦</button>
    <button onclick="location.href='../../../index.html'">トップ画面へ</button>
    <script>
        // URLからクエリパラメータを取得
        const urlParams = new URLSearchParams(window.location.search);
        const elapsedTime = parseFloat(urlParams.get('elapsedTime'));
        const coinScore = parseInt(urlParams.get('coinScore')); // collectedCoins は削除

        // 各コインの獲得枚数を取得
        const redCoins = parseInt(urlParams.get('redCoins'));
        const blueCoins = parseInt(urlParams.get('blueCoins'));
        const yellowCoins = parseInt(urlParams.get('yellowCoins'));

        // 時間ランクの判定
        let timeRank;
        if (elapsedTime <= 7.0) {
            timeRank = 'S';
        } else if (elapsedTime <= 10.0) {
            timeRank = 'A';
        } else if (elapsedTime <= 15.0) {
            timeRank = 'B';
        } else if (elapsedTime <= 20.0) {
            timeRank = 'C';
        } else {
            timeRank = 'D';
        }

        // コインスコアのランクの判定
        let coinRank;
        if (coinScore >= 130) {
            coinRank = 'S';
        } else if (coinScore >= 100) {
            coinRank = 'A';
        } else if (coinScore >= 80) {
            coinRank = 'B';
        } else if (coinScore >= 60) {
            coinRank = 'C';
        } else {
            coinRank = 'D';
        }

        // クリアメッセージの表示ロジック
        let messageElement = document.getElementById("result-message");

        if (timeRank !== "D" && coinRank !== "D") {
            // 両方ともCランク以上の場合、クリアメッセージを表示
            messageElement.textContent = "クリアおめでとうございます";
            messageElement.classList.remove('fail-message'); // 失敗メッセージのクラスを削除
        } else {
            // どちらかがDランクの場合、失敗メッセージを表示
            messageElement.textContent = "もう少し頑張りましょう";
            messageElement.classList.add('fail-message'); // 失敗メッセージのスタイルを適用
        }

        // 結果を表示する要素が存在するか確認
        const timeResultElement = document.getElementById('time-result');
        const coinResultElement = document.getElementById('coin-result');

        if (timeResultElement && coinResultElement) {
            // 時間とコインスコアを表示 (ランクに下線を追加)
            timeResultElement.innerHTML = `所要時間: ${elapsedTime} 秒 <span class="rank-underline">${timeRank}ランク</span>`;
            coinResultElement.innerHTML = `コインスコア: ${coinScore} (赤: ${redCoins}, 青: ${blueCoins}, 黄: ${yellowCoins}) <span class="rank-underline">${coinRank}ランク</span>`;
        } else {
            console.error('結果を表示する要素が見つかりません');
        }
    </script>
</body>
</html>
